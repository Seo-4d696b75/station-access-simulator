# スキルの無効化

アクセス処理において、相手スキルを無効化するスキルの詳細をここで示します

シミュレータの実装・ここでの解説は[駅メモ！公式ブログ「駅メモ！のスキルの発動順序について」](https://blog.ekimemo.com/post/179166914454/%E9%A7%85%E3%83%A1%E3%83%A2%E3%81%AE%E3%82%B9%E3%82%AD%E3%83%AB%E3%81%AE%E7%99%BA%E5%8B%95%E9%A0%86%E5%BA%8F%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6)を参考にしています

## スキル無効化の対象

> **Note**
> 原則１：無効化されたスキルは発動しない

これは無効化スキルの大前提なので説明は不要でしょう. 例えば、ちとせによって無効化されたサポーターのスキルは発動せず、ATKやDEFの増減が効かない場合があります. 

**一度無効化されたスキルは以降のアクセス処理において一切発動しなくなります.**

|発動しなくなる対象|例|  
|:--:|:----|  
|アクセス中、無効化以降のフェーズで発動するスキル| サポーターのATK・DEF増加、カウンター、ダメージの肩代わり |  
|アクセス終了直後に発動するスキル| セリアの回復スキル |  

[ちとせによって無効化されたセリアの回復スキルが発動しないように](./example/invalidate-skill.md#case-2-アクセス後に影響するスキル無効化)、アクセス直後に発動するタイプのスキルも無効化の影響を受けます.

## スキル無効化のタイミング・順序

アクセス処理におけるスキル発動はいくつかのフェーズ（ステップ）に分けられています. いま議論になっている無効化スキルはすべて同じフェーズで発動します. （シミュレータの実装では`onAccessBeforeStart`コールバックに該当・[他フェーズの詳細や順序はこちら](./access.md)）

> **Note**
> 原則2：同じフェーズ内で発動するスキルは「攻撃側」が先に発動する

同じ無効化スキルと無効化の対象が編成されていても、アクセス側・被アクセス側のどちらに編成されるかの違いで結果が変わる場合もあります

<img width="420" alt="image" src="https://user-images.githubusercontent.com/25225028/210316191-fe722860-3973-4049-ad9c-21a7e73df95c.png">

[例えば攻撃側にまひる・守備側にちとせが編成されている場合は](./example/invalidate-skill.md#case3)、攻撃側のまひるが先に発動してちとせのスキルを無効化します. サポーターはちとせに無効化されずに発動します.

> **Note**
> 原則3：同じ編成内の無効化スキル同士は互いの発動を阻害しない

![image](https://user-images.githubusercontent.com/25225028/222692686-cf8a27ac-cef0-458c-94eb-07fc12fb3b3d.png)


[例えば相手の属性に応じた無効化スキルを持つまひる・てすと・すすぐの３人が同じ編成内にる場合も、](./example/invalidate-skill.md#case5)３人全員の無効化スキルが発動します. 


## 発動済みのスキルと無効化

> **Note**
> 原則4：すでに発動したスキルは無効化の影響を受けない

> **Warning**
> スキルの無効化の処理が変更され、無効化の対象の有無が厳密に考慮されます
>
> - バージョン0.5.0未満: 発動済みのスキルも無効化の対象に**なる**
> - バージョン0.5.0以降: 発動済みのスキルは無効化の対象に**ならない**

公式ブログの説明では発動済みのスキルも無効化対象になる風に書かれています

> 無効化されたスキルは、無効化したでんこのスキルが後から無効化されても復活しません

しかし、このライブラリの実装では対象になりません. 無効化の処理を説明すると、

1. 無効化スキルの発動判定が通る（発動の条件・発動確率の判定）
2. 無効化の対象を指定するフィルターが追加される
3. 他のスキルの発動判定が行われる（無効化・確率以外の発動条件は満たしている）
4. 無効化フィルターに引っかかる場合は発動判定が通らない

無効化の有無は対象となるスキルの発動時に判定されるため、**発動済みのスキルには一切干渉しません**  
加えて、1.の無効化スキルの発動判定が通った段階では発動扱いされず、4.の無効化対象が見つかる場合に初めて発動と記録されます.

> **Note**
> 原則5：無効化の対象が不在の場合は発動しない


<img alt="image" src="https://user-images.githubusercontent.com/25225028/222685621-04156053-8e6d-415d-a3c8-96c473fbdcbb.png">


[例えば攻撃側にちとせ・守備側にまひるが編成されている場合は](./example/invalidate-skill.md#case4)、攻撃側のちとせが先に発動してサポーターを無効化します. 守備側のまひるの無効化スキルでは、発動済みのちとせは対象外となり発動しません.