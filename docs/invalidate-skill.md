# スキルの無効化

アクセス処理において、相手スキルを無効化するスキルの詳細をここで示します

シミュレータの実装・ここでの解説は[駅メモ！公式ブログ「駅メモ！のスキルの発動順序について」](https://blog.ekimemo.com/post/179166914454/%E9%A7%85%E3%83%A1%E3%83%A2%E3%81%AE%E3%82%B9%E3%82%AD%E3%83%AB%E3%81%AE%E7%99%BA%E5%8B%95%E9%A0%86%E5%BA%8F%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6)を参考にしています

## スキル無効化の対象

**原則１** 無効化されたスキルは発動しない

これは無効化スキルの大前提なので説明は不要でしょう. 例えば、ちとせによって無効化されたサポーターのスキルは発動せず、ATKやDEFの増減が効かない場合があります. 

一度無効化されたスキルは以降のアクセス処理において一切発動しなくなります. スキルの発動判定の対象から除外されます. 

|発動しなくなる対象|例|  
|:--:|:----|  
|無効化された以降のフェーズで発動するスキル| サポーターのATK・DEF増加、カウンター、ダメージの肩代わり |  
|アクセス終了直後に発動するスキル| セリアの回復スキル |  

[ちとせによって無効化されたセリアの回復スキルが発動しないように](./example/invalidate-skill.md#case-2-アクセス後に影響するスキル無効化)、アクセス直後に発動するタイプのスキルも無効化の影響を受けます.

## スキル無効化のタイミング・順序

アクセス処理におけるスキル発動はいくつかのフェーズ（ステップ）に分けられています. いま議論になっている無効化スキルはすべて同じフェーズで発動します. （シミュレータの実装では`before_access`・[他フェーズの詳細や順序はこちら](./access.md)）

**原則2** 同じフェーズ内で発動するスキルは「攻撃側」が先に発動する

同じ無効化スキルと無効化の対象が編成されていても、アクセス側・被アクセス側のどちらに編成されるかの違いで結果が変わる場合もあります

<img width="420" alt="image" src="https://user-images.githubusercontent.com/25225028/210316191-fe722860-3973-4049-ad9c-21a7e73df95c.png">

[例えば攻撃側にまひる・守備側にちとせが編成されている場合は](./example/invalidate-skill.md#case3)、攻撃側のまひるが先に発動してちとせのスキルを無効化します. サポーターはちとせに無効化されずに発動します.

**原則3** 同じ編成内の無効化スキル同士は互いの発動を阻害しない

例えば相手の属性に応じた無効化スキルを持つまひる・てすと・すすぐの３人が同じ編成内にいても３人全員の無効化スキルが発動します. 

公式ブログの説明では

> 同じ編成内のスキル無効化効果同士は、互いを無効化しません

とありますが、シミュレータの実装では同編成内の無効化スキルは互いに無効化します. ただし、スキル発動の有無を判定する処理を編成ごと・各フェーズの最初に一括で行うため、「互いを無効化する」効果を反映する段階ではすでに発動判定には影響がありません. 結果として同編成内の無効化スキルはすべて発動します（無効化対象が存在すれば）


## 発動済みスキルの無効化


**原則4** すでに発動したスキルが無効化されても「発動した事実」「発動した効果」は消えずそのまま残る

発動したスキルを後から無効化する場合、発動済みのスキルの効果を元に戻すことはしません. 無効化スキルが無効化するのはスキルの発動であり、スキルの発動による効果は対象外です. 

特に問題となるのが攻守の両編成に無効化スキルが存在する場合です. 公式ブログでも言及があるとおり、先に発動する攻撃側の無効化スキルが後から守備側の無効化スキルで無効化されても、

> 無効化されたスキルは、無効化したでんこのスキルが後から無効化されても復活しません

<img width="424" alt="image" src="https://user-images.githubusercontent.com/25225028/210317751-7791d3a6-9070-43d5-ae29-20a26cac42ef.png">

[例えば攻撃側にちとせ・守備側にまひるが編成されている場合は](./example/invalidate-skill.md#case4)、攻撃側のちとせが先に発動してサポーターを無効化します. 次に守備側のまひるがちとせを無効化しますが、「ちとせがサポーターを無効化した」事実は変化しません. 依然としてサポーターは無効化されたままで発動しません. 